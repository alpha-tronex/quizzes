<section class="masthead bg-primary text-white text-center">
  <div class="container">
    <h2 class="mb-4">User Management</h2>
    
    <div class="card text-dark">
      <div class="card-body">
        <div class="row text-start">
          <div class="col-md-8 offset-md-2">
            
            <div *ngIf="errorMessage" class="alert alert-danger">
              {{ errorMessage }}
            </div>

            <div *ngIf="loading" class="text-center py-4">
              <p>Loading users...</p>
            </div>

            <div *ngIf="!loading" class="mb-4">
              <label for="userSelect" class="form-label"><strong>Select User:</strong></label>
              <select 
                id="userSelect" 
                class="form-select form-control" 
                (change)="onUserSelect($event)"
                [disabled]="users.length === 0">
                <option value="">-- Choose a user --</option>
                <option *ngFor="let user of users" [value]="user.id">
                  {{ getUserDisplayName(user) }}
                </option>
              </select>
              <small class="text-muted" *ngIf="users.length === 0">No users found.</small>
              <small class="text-muted" *ngIf="users.length > 0">{{ users.length }} user(s) available</small>
            </div>

            <div *ngIf="selectedUser" class="card" style="background-color: #f8f9fa;">
              <div class="card-body">
                <h5 class="card-title mb-3">User Details</h5>
                
                <div class="mb-2">
                  <strong>Username:</strong> {{ selectedUser.uname }}
                </div>
                
                <div class="mb-2" *ngIf="selectedUser.fname || selectedUser.lname">
                  <strong>Name:</strong> {{ selectedUser.fname }} {{ selectedUser.lname }}
                </div>
                
                <div class="mb-2" *ngIf="selectedUser.email">
                  <strong>Email:</strong> {{ selectedUser.email }}
                </div>
                
                <div class="mb-2" *ngIf="selectedUser.phone">
                  <strong>Phone:</strong> {{ selectedUser.phone }}
                </div>
                
                <div class="mb-2">
                  <strong>Type:</strong> 
                  <span class="badge" [ngClass]="selectedUser.type === 'admin' ? 'bg-danger' : 'bg-primary'">
                    {{ selectedUser.type || 'student' }}
                  </span>
                  <a href="javascript:void(0)" 
                     class="ms-2 text-decoration-none" 
                     (click)="changeUserType(selectedUser)"
                     title="Change user type">
                    <small>(change)</small>
                  </a>
                </div>
                
                <div class="mb-3 mt-3 d-flex gap-2 justify-content-center">
                  <button 
                    class="btn btn-sm btn-primary" 
                    [routerLink]="['/admin/user-details', selectedUser.id]">
                    Edit User Details
                  </button>
                  <button 
                    class="btn btn-sm btn-danger" 
                    style="margin-left: 5px;" 
                    (click)="deleteUser(selectedUser)"
                    title="Delete user">
                    Delete User
                  </button>
                </div>
                
                <div class="mb-2">
                  <strong>User ID:</strong> <small class="text-muted">{{ selectedUser.id }}</small>
                </div>
                
                <!-- Quizzes Section -->
                <div class="mt-4" *ngIf="selectedUser.quizzes && selectedUser.quizzes.length > 0">
                  <h6 class="mb-3">Quizzes Taken ({{ selectedUser.quizzes.length }})</h6>
                  <div class="table-responsive">
                    <table class="table table-sm table-striped">
                      <thead>
                        <tr>
                          <th>Quiz</th>
                          <th>Date</th>
                          <th>Score</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let quiz of selectedUser.quizzes">
                          <td>{{ quiz.title }}</td>
                          <td>{{ formatDate(quiz.completedAt) }}</td>
                          <td>
                            <span class="badge" [ngClass]="getScoreBadgeClass(quiz.score, quiz.totalQuestions)">
                              {{ quiz.score }}/{{ quiz.totalQuestions }}
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <div class="mt-3" *ngIf="!selectedUser.quizzes || selectedUser.quizzes.length === 0">
                  <p class="text-muted"><em>No quizzes taken yet.</em></p>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>
