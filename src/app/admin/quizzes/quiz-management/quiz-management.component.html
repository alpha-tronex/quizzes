<section class="masthead bg-primary text-white text-center">
  <div class="container">
    <app-admin-breadcrumb></app-admin-breadcrumb>
    
    <h2 class="mb-4">Quiz Data Management</h2>
    
    <div class="card text-dark">
      <div class="card-body">
        <div *ngIf="message" class="alert" [ngClass]="messageType === 'success' ? 'alert-success' : 'alert-danger'">
          {{ message }}
        </div>

        <div class="row text-start">
          <!-- Section 1: Edit Quiz File -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-edit"></i> Edit Quiz File
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Select and edit an existing quiz file</p>
                
                <div class="mb-3">
                  <label for="editQuizSelect" class="form-label"><strong>Select Quiz:</strong></label>
                  <select 
                    id="editQuizSelect" 
                    class="form-select" 
                    [(ngModel)]="selectedEditQuizId"
                    [disabled]="quizzes.length === 0">
                    <option value="">-- Choose a quiz --</option>
                    <option *ngFor="let quiz of quizzes" [value]="quiz.id">
                      {{ quiz.title }} (ID: {{ quiz.id }})
                    </option>
                  </select>
                  <small class="text-muted" *ngIf="quizzes.length === 0">No quiz files found</small>
                  <small class="text-muted" *ngIf="quizzes.length > 0">{{ quizzes.length }} quiz file(s) available</small>
                </div>

                <button 
                  class="btn btn-secondary w-100" 
                  [disabled]="!selectedEditQuizId"
                  [routerLink]="['/admin/edit-quiz', selectedEditQuizId]">
                  <i class="fas fa-edit"></i> Edit Selected Quiz
                </button>
              </div>
            </div>
          </div>

          <!-- Section 2: Delete User Quiz Data -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                  <i class="fas fa-user-minus"></i> Delete User Quiz Data
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Remove all quiz history for a specific user</p>
                
                <div class="mb-3">
                  <label for="userSelect" class="form-label"><strong>Select User:</strong></label>
                  <select 
                    id="userSelect" 
                    class="form-select" 
                    [(ngModel)]="selectedUserId"
                    [disabled]="users.length === 0">
                    <option value="">-- Choose a user --</option>
                    <option *ngFor="let user of users" [value]="user.id">
                      {{ getUserDisplayName(user) }}
                      <span *ngIf="user.quizzes && user.quizzes.length > 0">
                        ({{ user.quizzes.length }} quiz{{ user.quizzes.length !== 1 ? 'zes' : '' }})
                      </span>
                    </option>
                  </select>
                </div>

                <button 
                  class="btn btn-warning w-100" 
                  [disabled]="!selectedUserId || loading"
                  (click)="deleteUserQuizData()">
                  <i class="fas fa-trash"></i> Delete User's Quiz Data
                </button>
              </div>
            </div>
          </div>

          <!-- Section 2: Delete all quiz data from all users -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-users-slash"></i> Delete All User Quiz Data
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Remove all quiz history from all users in the database</p>
                
                <div class="alert alert-danger mb-3">
                  <i class="fas fa-exclamation-triangle"></i>
                  <strong>Warning:</strong> This will delete ALL quiz data from ALL users. This action cannot be undone!
                </div>

                <button 
                  class="btn btn-danger w-100" 
                  [disabled]="loading"
                  (click)="deleteAllUsersQuizData()">
                  <i class="fas fa-bomb"></i> Delete All Users' Quiz Data
                </button>
              </div>
            </div>
          </div>

          <!-- Section 3: Delete specific quiz from specific user -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                  <i class="fas fa-user-times"></i> Delete Specific Quiz from User
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Remove a specific quiz entry from a user's history</p>
                
                <div class="mb-3">
                  <label for="userSelectSpecific" class="form-label"><strong>Select User:</strong></label>
                  <select 
                    id="userSelectSpecific" 
                    class="form-select" 
                    [(ngModel)]="selectedUserIdForSpecificQuiz"
                    (change)="onUserSelectForSpecificQuiz()"
                    [disabled]="users.length === 0">
                    <option value="">-- Choose a user --</option>
                    <option *ngFor="let user of users" [value]="user.id">
                      {{ getUserDisplayName(user) }}
                      <span *ngIf="user.quizzes && user.quizzes.length > 0">
                        ({{ user.quizzes.length }} quiz{{ user.quizzes.length !== 1 ? 'zes' : '' }})
                      </span>
                    </option>
                  </select>
                </div>

                <div class="mb-3" *ngIf="selectedUserIdForSpecificQuiz">
                  <label for="userQuizSelect" class="form-label"><strong>Select Quiz:</strong></label>
                  <select 
                    id="userQuizSelect" 
                    class="form-select" 
                    [(ngModel)]="selectedUserQuizId"
                    [disabled]="userQuizzes.length === 0">
                    <option value="">-- Choose a quiz --</option>
                    <option *ngFor="let quiz of userQuizzes" [value]="quiz._id">
                      {{ quiz.title }} - {{ formatQuizDate(quiz.completedAt) }} (Score: {{ quiz.score }}/{{ quiz.totalQuestions }})
                    </option>
                  </select>
                  <small class="text-muted" *ngIf="userQuizzes.length === 0">No quizzes found for this user</small>
                  <small class="text-muted" *ngIf="userQuizzes.length > 0">{{ userQuizzes.length }} quiz entry(ies) found</small>
                </div>

                <button 
                  class="btn btn-warning w-100" 
                  [disabled]="!selectedUserIdForSpecificQuiz || !selectedUserQuizId || loading"
                  (click)="deleteSpecificUserQuiz()">
                  <i class="fas fa-trash-alt"></i> Delete Selected Quiz Entry
                </button>
              </div>
            </div>
          </div>

          <!-- Section 4: Delete a specific quiz file -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                  <i class="fas fa-file-excel"></i> Delete Quiz File
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Remove a specific quiz file from the server</p>
                
                <div class="mb-3">
                  <label for="quizSelect" class="form-label"><strong>Select Quiz:</strong></label>
                  <select 
                    id="quizSelect" 
                    class="form-select" 
                    [(ngModel)]="selectedQuizId"
                    [disabled]="quizzes.length === 0">
                    <option value="">-- Choose a quiz --</option>
                    <option *ngFor="let quiz of quizzes" [value]="quiz.id">
                      {{ quiz.title }} (ID: {{ quiz.id }})
                    </option>
                  </select>
                  <small class="text-muted" *ngIf="quizzes.length === 0">No quiz files found</small>
                  <small class="text-muted" *ngIf="quizzes.length > 0">{{ quizzes.length }} quiz file(s) available</small>
                </div>

                <button 
                  class="btn btn-info w-100" 
                  [disabled]="!selectedQuizId || loading"
                  (click)="deleteQuizFile()">
                  <i class="fas fa-trash-alt"></i> Delete Quiz File
                </button>
              </div>
            </div>
          </div>

          <!-- Section 5: Delete all quiz files -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-folder-minus"></i> Delete All Quiz Files
                </h5>
              </div>
              <div class="card-body">
                <p class="text-muted">Remove all quiz files from the server</p>
                
                <div class="alert alert-danger mb-3">
                  <i class="fas fa-exclamation-triangle"></i>
                  <strong>Warning:</strong> This will delete ALL quiz files. Users will not be able to take any quizzes until new ones are uploaded!
                </div>

                <button 
                  class="btn btn-danger w-100" 
                  [disabled]="loading"
                  (click)="deleteAllQuizFiles()">
                  <i class="fas fa-fire"></i> Delete All Quiz Files
                </button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="loading" class="text-center mt-4">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Processing...</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Confirmation Modal -->
<alpha-tronex-modal
  [show]="showConfirmModal"
  [title]="confirmTitle"
  [type]="'danger'"
  [content]="confirmMessage + ' This action cannot be undone.'"
  (close)="closeConfirmModal()"
  (confirm)="confirmActionExecute()">
  <div modal-actions>
    <button type="button" class="btn btn-secondary" (click)="closeConfirmModal()">Cancel</button>
    <button type="button" class="btn btn-danger ml-2 mr-2" (click)="confirmActionExecute()">
      <i class="fas fa-trash"></i> Confirm Delete
    </button>
  </div>
</alpha-tronex-modal>
